package com.hemebiotech.analytics;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;

public class ReadSymptomDataFromFile implements ISymptomReader {
	/** méthode permettant la lecture des symptômes */
	public List<String> getSymptoms(String symptômes) {
		/** liste qui va recevoir les symptômes lus */
		List<String> resulta = new ArrayList<String>();

		if (symptômes != null) {
			try {
				BufferedReader reader = new BufferedReader(new FileReader(symptômes));
				String line = reader.readLine();
				while (line != null) {
					resulta.add(line);
					line = reader.readLine();
				}
				/** classement des symptômes par ordre alphabétique */
				Collections.sort(resulta);

				reader.close();

			} catch (IOException e) {
				e.printStackTrace();
			}
		}

		return resulta;
	}

	/** méthode qui retourne le nombre d'occurrences des symptômes */
	public Map<String, Integer> getSymptomsWithOccurences(List<String> symptoms) {
		Map<String, Integer> map = new LinkedHashMap<String, Integer>();
		/** parcours la liste des symptômes passer en paramètre de la méthode */
		for (String symptom : symptoms) {
			if (map.containsKey(symptom) == false) {
				/** copie la liste dans la carte */
				map.put(symptom, Collections.frequency(symptoms, symptom));
			}
		}

		return map;
	}

	/**
	 * méthode qui copie les symptômes dans répertoire personnel de l'utilisateur
	 */
	public void writeSymptomsAndOccurences(Map<String, Integer> mapSymptomsOccurences) throws IOException {
		/** récupère le répertoire personnel de l'utilisateur */
		String currentUsersHomeDir = System.getProperty("user.home");
		String path = currentUsersHomeDir + System.getProperty("file.separator") + "result.out";
		/**
		 * objet permettant de copier le fichier dans le répertoire personnel de
		 * l'utilisateur
		 */
		FileWriter writer = new FileWriter(path);
		if (mapSymptomsOccurences != null && !mapSymptomsOccurences.isEmpty()) {
			mapSymptomsOccurences.forEach((key, value) -> {
				try {
					/** copie le fichier dans le répertoire personnel de l'utilisateur */
					writer.write(key + "=" + value);
					writer.write(System.getProperty("line.separator"));
				} catch (IOException e) {
					e.printStackTrace();
				}
			});
		} else {
			writer.write("aucun symptome n'a été trouvé");
		}
		writer.close();
		System.out.println("le fichier de sortie se trouve: " + path);
	}
}
